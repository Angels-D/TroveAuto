[General]
SyntaxVersion=2
BeginHotkey=0
BeginHotkeyMod=0
PauseHotkey=0
PauseHotkeyMod=0
StopHotkey=0
StopHotkeyMod=0
RunOnce=1
EnableWindow=
MacroID=58ef3714-8ca9-4883-b4f5-47b8d2d34378
Description=Trove自动钓鱼-音频检测-By妖尾
Enable=0
AutoRun=0
[Repeat]
Type=0
Number=1
[SetupUI]
Type=1
QUI=Main
[Relative]
SetupOCXFile=
[Comment]
Trove自动钓鱼-音频检测版
注：请将游戏音乐设为背景播放，仅保留声效并提升至最高音量，请保持游戏仅有钓鱼提示音
By妖尾

[UIPackage]
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


[Script]
Global i, V, FID, TID
Event Main.Load 
    V = 150
    Main.ProgressBar1.Value = 0
    Main.FishGrid.SetColumnEditable 0, False
    Main.FishGrid.SetColumnEditable 5, False
End Event
Event Main.Slider1.Slide
    V = Main.Slider1.Value 
    Main.InputBox1.Text = V
End Event
Event Main.InputBox1.Change
    V = Main.InputBox1.Text
    Main.Slider1.Value = V
End Event
Event Main.FishMsgBtn.Click
    Dim Voice(4)
    Main.ProgressBar1.Value = 0
    Main.ProgressBar1.Value = 5
    RunApp ("C:\Windows\System32\SndVol.exe")
    Delay 500
    Voice(0) = Plugin.Window.Find("#32770",0)
    Call Plugin.Window.Size(Voice(0), 2968, 353)
    Call Plugin.Window.Move(Voice(0), -2920, 700)
    Voice(1) = Plugin.Window.FindEx(Voice(0), 0, "TileListView", "")
    Voice(2) = Plugin.Window.FindEx(Voice(1), 0, "TileSled Window", "")
    Main.ProgressBar1.Value = 20
    G = Plugin.Window.SearchEx("SDL_app", "Trove", 0)
    GameGB = Split(G, "|")
    VoiceGB = Split(G, "|")
    Main.ProgressBar1.Value = 30
    If  UBound(GameGB) >= 0 Then 
        i = 0
        For UBound(GameGB)
            Call Plugin.Window.SetText(GameGB(i), "正在检测中")
            Delay 1000
            Rem A
            Voice(3) = Plugin.Window.FindEx(Voice(2), Voice(3), "#32770", "")
            Voice(4) = Plugin.Window.FindEx(Voice(3), 0, "Static", "正在检测中")
            If Voice(3) = 0 Then 
                MessageBox "未找到声音句柄!"
                i = 0
                Call Plugin.Window.SetText(GameGB(i), "Trove")
                Main.ProgressBar1.Value = 0
                Exit For
            Elseif Voice(4) = 0 then
                Goto A
            Else 
                VoiceGB(i) = Plugin.Window.FindEx(Voice(3), 0, "msctls_trackbar32", "")
                Call Plugin.Window.SetText(GameGB(i), CStr(i + 1) + "号")
                Main.FishGrid.RowCount = Main.FishGrid.RowCount + 1
                Main.FishGrid.SetColumnEditable 0, False
                Main.FishGrid.SetColumnEditable 5, False
                Main.FishGrid.SetItemText i + 1, 0, CStr(i + 1) + "号"
                Main.FishGrid.SetItemText i + 1, 1, CStr(GameGB(i))
                Main.FishGrid.SetItemText i + 1, 2, CStr(VoiceGB(i))
            End If
            Voice(3) = 0
            i = i + 1
            Main.ProgressBar1.Value = Main.ProgressBar1.Value + 70 /  UBound(GameGB)
        Next
        MessageBox "检测结束"
    Else 
        MessageBox "未找到游戏句柄!"
    End If
    i = 0
    Main.ProgressBar1.Value = 0
End Event
Event Main.Button2.Click
    Main.ProgressBar1.Value = 0
    For Main.FishGrid.RowCount - 1
        i = i + 1
        If Main.FishGrid.GetItemText(i, 1) <> "" Then 
            Call Plugin.Window.SetText(Main.FishGrid.GetItemText(i, 1), "Trove")
        End If
        Main.ProgressBar1.Value = Main.ProgressBar1.Value + 80 / (Main.FishGrid.RowCount - 1)
    Next
    i = 0
    Main.FishGrid.RowCount =2
    Main.FishGrid.DeleteAllItems 
    V = 150
    Main.Slider1.Value = V
    Main.InputBox1.Text = V
    Main.ProgressBar1.Value = 100
    MessageBox "重置完成"
    Main.ProgressBar1.Value = 0
End Event
Event Main.FishAddBtn.Click
    Main.FishGrid.RowCount = Main.FishGrid.RowCount + 1
    Main.FishGrid.SetColumnEditable 0, False
    Main.FishGrid.SetColumnEditable 5, False
    X = Main.FishGrid.RowCount
End Event
Event Main.FishSubBtn.Click
    If Main.FishGrid.RowCount > 2 Then 
        Main.FishGrid.RowCount = Main.FishGrid.RowCount - 1
        X = Main.FishGrid.RowCount
    End If
End Event
Event Main.FishRunBtn.Click
    If Main.FishRunBtn.Caption = "开启" Then 
        Main.FishMsgBtn.Enabled = false
        Main.Button2.Enabled = false
        Main.FishAddBtn.Enabled = false
        Main.FishSubBtn.Enabled = false
        Main.Slider1.Enabled = false
        Main.InputBox1.Enabled = false
        Main.FishGrid.SetColumnEditable 1, False
        Main.FishGrid.SetColumnEditable 2, False
        Main.FishGrid.SetColumnEditable 3, False
        ReDim FID(Main.FishGrid.RowCount - 1),TID(Main.FishGrid.RowCount - 1)
        For Main.FishGrid.RowCount - 1
            i = i + 1
            If Main.FishGrid.GetCheckBoxValue(i, 3) Then 
                FID(i) = BeginThread(Fish)
                TID(i) = BeginThread(Time)
                Delay 500 
            End If
        Next
        Main.FishRunBtn.Caption = "关闭"
        i = 0
    Else 
        Main.FishMsgBtn.Enabled = True
        Main.Button2.Enabled = True
        Main.FishAddBtn.Enabled = True
        Main.FishSubBtn.Enabled = True
        Main.Slider1.Enabled = True
        Main.InputBox1.Enabled = True
        Main.FishGrid.SetColumnEditable 1, True
        Main.FishGrid.SetColumnEditable 2, True
        Main.FishGrid.SetColumnEditable 3, True
        For Main.FishGrid.RowCount - 1
            i = i + 1
            StopThread FID(i)
            StopThread TID(i)
            Delay 100 
        Next
        i = 0
        Main.FishRunBtn.Caption = "开启"
    End If
End Event
Sub Fish()
    Z = i
    Game = Main.FishGrid.GetItemText(Z, 1)
    Voice = Main.FishGrid.GetItemText(Z, 2)
    Main.FishGrid.SetProgressBarValue Z, 4, 0
    Call Plugin.Bkgnd.KeyPress(Game, 70)
    Delay 3000
    Do
        XY = Plugin.Bkgnd.FindColorEx(Voice, 5, 0, 10, Main.InputBox1.Text, "5AC359", 1, 0.9)
        ZB = InStr(XY, "|")
        Main.FishGrid.SetProgressBarValue Z, 4, 25
        If ZB = 2 Then 
            Main.FishGrid.SetProgressBarValue Z, 4, 50
            Call Plugin.Bkgnd.KeyPress(Game, 70)
            Main.FishGrid.SetProgressBarValue Z, 4, 70
            Delay 2000
            Main.FishGrid.SetProgressBarValue Z, 4, 80
            Call Plugin.Bkgnd.KeyPress(Game, 70)
            Main.FishGrid.SetProgressBarValue Z, 4, 100
            Delay 3000
        End If
        Main.FishGrid.SetProgressBarValue Z, 4, 0
        Delay 100
    Loop
End Sub
Sub Time()
    Z = i
    Main.FishGrid.SetItemText Z, 5, CStr(H) + ":" + CStr(M) + ":" + CStr(S)
    H = 0
    M = 0
    S = 0
    Do
        Delay 1000
        If S = 60 AND M = 60 Then 
            H = H + 1
            S = 0
            M = 0
        ElseIf S = 60 Then
            M = M + 1
            S = 0
        Else 
            S = S + 1
        End If
        Main.FishGrid.SetItemText Z, 5, CStr(H) + ":" + CStr(M) + ":" + CStr(S)
    Loop
End Sub
